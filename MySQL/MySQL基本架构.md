# MySQL基本架构

<img src="C:\Users\李佳庆\Desktop\APP\笔记本\图片库\image-20201022194838499.png" alt="image-20201022194838499" style="zoom: 67%;" />

### 1. 连接器

我们进行查询之前，要先连接数据库，此时连接器负责跟客户端建立连接、获取权限、维持和管理连接。（涉及TCP握手机制）

show processlist查询连接。

![image-20201022193634603](C:\Users\李佳庆\Desktop\APP\笔记本\图片库\image-20201022193634603.png)

当数据库连接超过wait_timeout参数（默认8小时），会自动断开连接。如何解决这个问题？

1. 超时重新连接
2. 使用长连接。这里有个缺点：MySQL在执行过程中临时使用的内存是管理在连接对象里面的，只有断开连接才会得到释放，如果一直长连接就会导致OOM。
3. 使用一段时间长连接，或执行过一个占用内存比较大的查询后执行**mysql_reset_connection**，重新初始化连接，避免重连。



### 2. 查询缓存

MySQL拿到一个查询请求之后，会先到查询缓存看看，是不是之前执行过这条语句。执行过的语句会在内存中以key-value的形式存储。查询的时候拿着语句先去缓存中查询，如果能够命中就返回缓存的value，不命中就执行后面的阶段。



### 3. 分析器

词法分析，语法分析



### 4. 优化器



### 5. 执行器